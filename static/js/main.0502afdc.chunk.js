(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{17:function(e,t,a){e.exports=a(28)},22:function(e,t,a){},23:function(e,t,a){},28:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),o=a(16),r=a.n(o),i=(a(22),a(2)),l=a(3),m=a(6),c=a(4),u=a(5),d=(a(23),a(14));function h(e){var t=Object(d.a)({},e.commentTree.tx),a=t.out[0].s3+t.tx.h,n=t.out[0].s5,o=t.in[0].e.a,r=a.length/64<6&&e.userId!=t.out[0].s6,i=Object(d.a)({},e.commentTree);delete i.tx,delete i.comments;var l=[];(i=Object.values(i)).sort(function(e,t){return t.comments-e.comments});for(var m=0;m<i.length;m++)l.push(s.a.createElement(h,{replyHandler:e.replyHandler,userId:e.userId,commentTree:i[m]}));return s.a.createElement("div",{className:"comment"},s.a.createElement("div",{className:"comment-metadata"},s.a.createElement("div",{className:"metadata"},t.out[0].s5),s.a.createElement("div",{className:"metadata"},t.timeago),r?s.a.createElement("div",{className:"metadata metadata-button",onClick:function(){return e.replyHandler(a,n,o)}}," reply"):null),s.a.createElement("div",{className:"comment-content"},decodeURIComponent(t.out[0].s4)),l)}function p(e){var t=e.comments.slice();t.sort(function(e,t){return t.comments-e.comments});var a=[];if(e.comments)for(var n=0;n<e.comments.length;n++)a.push(s.a.createElement(h,{replyHandler:e.replyHandler,userId:e.userId,commentTree:t[n]}));return s.a.createElement("div",{className:"comments-container"},a,0==a.length?"No comments!":null)}var g=a(10).default;function f(e){for(var t="",a=0;a<e.length;a++)t+=""+e.charCodeAt(a).toString(16);return t}var v=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(m.a)(this,Object(c.a)(t).call(this,e))).toggleCommentsHandler=function(){a.setState({showComments:!a.state.showComments})},a.toggleTipHandler=function(){a.props.loggedIn?a.setState({tip:!a.state.tip}):a.props.replyHandler()},a.state={showComments:!1,tip:!1},a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e,t=this,a=decodeURI(this.props.postData.tx.out[0].s5),n=decodeURIComponent(this.props.postData.tx.out[0].s4),o=this.props.postData.tx.out[0].s6,r=this.props.showCommentsFor==this.props.postData.tx.tx.h,i=this.props.postData.tx.out[0].s7==this.props.userId,l=this.props.postData.voters.includes(this.props.userId),m=!i&&!l;e=this.props.postData.tx.timeago?this.props.postData.tx.timeago:function(e){var t=Date.now()-e;return t<6e4?Math.round(t/1e3)+" seconds ago":t<36e5?Math.round(t/6e4)+" minutes ago":t<864e5?Math.round(t/36e5)+" hours ago":t<2592e6?Math.round(t/864e5)+" days ago":t<31536e6?Math.round(t/2592e6)+" months ago":Math.round(t/31536e6)+" years ago"}(this.props.postData.tx.timestamp);var c=this.props.postData.reward,u=JSON.parse(c/1e8).toString(),d=s.a.createElement("div",{style:{height:50}});if(this.props.loggedIn&&!this.state.tip?d=s.a.createElement(g,{outputs:[{amount:0,currency:"BSV",type:"SCRIPT",script:"OP_RETURN "+f("13beK8bifnhuC8pawWvMrPCaWoTQi5LnZf")+" "+f("post/vote")+" "+f("vote")+" "+f(this.props.postData.tx.tx.h)+" "+f(this.props.userId)},{to:this.props.postData.tx.in[0].e.a,amount:"0.01",currency:"USD"}]}):this.props.loggedIn&&this.state.tip&&(d=s.a.createElement(g,{to:this.props.postData.tx.in[0].e.a,amount:"0.01",currency:"BSV",editable:!0})),1==u.length)u+=".00000000";else if(u.length<10)for(;u.length<10;)u+="0";var h=s.a.createElement("div",{className:"metadata metadata-button",onClick:function(){return t.props.replyHandler(t.props.postData.tx.tx.h,o,t.props.postData.tx.in[0].e.a)}},"reply"),v=s.a.createElement("div",{className:"metadata metadata-button",onClick:this.toggleTipHandler},this.state.tip?"vote":"tip");return s.a.createElement("div",{className:"post-container"},s.a.createElement("div",{className:"post"},s.a.createElement("div",null,s.a.createElement("div",{className:"post-data"},s.a.createElement("div",{className:"reward"},u,s.a.createElement("strong",null,"\u20bf")," "),s.a.createElement("div",{className:"post-title",style:{cursor:"pointer"},onClick:function(){return window.open(a)}},n)),s.a.createElement("div",{className:"post-metadata"},s.a.createElement("div",{className:"metadata"}," (",e,")"),s.a.createElement("div",{className:"metadata"},o),s.a.createElement("div",{className:"metadata",style:{cursor:"pointer"},onClick:function(){return t.props.toggleComments(t.props.postData.tx)}}," ",r?"hide comments \u25bc":"show comments \u25b6"),i?null:[h,v])),m||this.state.tip?s.a.createElement("div",{style:{width:this.state.tip?150:120}},d):s.a.createElement("div",{style:{height:50,width:120,display:"flex",alignItems:"center",justifyContent:"center"}},l?"Voted! \ud83d\uddf3\ufe0f":null)),r?s.a.createElement(p,{replyHandler:this.props.replyHandler,userId:this.props.userId,comments:this.props.comments}):null)}}]),t}(s.a.Component),y=a(12),E=a(10).default,b=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(m.a)(this,Object(c.a)(t).call(this,e))).onPaymentHandler=function(e){var t=new y.a;""!=a.state.input&&(t.set("userId",e.userId.toString(),{path:"/"}),t.set("username",a.state.input,{path:"/"}),a.props.loginHandler()),console.log(e.userId),console.log(e)},a.inputOnChangeHandler=function(e){a.setState({input:e.target.value})},a.state={input:""},a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"login-container"},s.a.createElement("div",{className:"login-alert w-form"},s.a.createElement("form",{id:"email-form-3",name:"email-form-3","data-name":"Email Form 3",className:"login-form"},s.a.createElement("div",{className:"div-block-2",onClick:this.props.xHandler},s.a.createElement("div",{className:"login-cancel"},"X")),s.a.createElement("div",{className:"login-title",style:{pointerEvents:"none"}},"Login"),s.a.createElement("input",{onChange:this.inputOnChangeHandler,type:"text",className:"login-username w-input",maxLength:256,name:"name-2","data-name":"Name 2",placeholder:"Desired Username",id:"name-2"}),s.a.createElement("div",{className:"mb-container"},s.a.createElement(E,{to:"112",amount:"0.01",currency:"USD",onPayment:this.onPaymentHandler})))))}}]),t}(s.a.Component),w=a(10).default,N=function(e){for(var t="",a=0;a<e.length;a++)t+=""+e.charCodeAt(a).toString(16);return t},x=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(m.a)(this,Object(c.a)(t).call(this,e))).inputChangeHandler=function(e){a.setState({reply:e.target.value})},a.state={reply:""},a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"new-reply-container"},s.a.createElement("div",{className:"new-reply-form w-form"},s.a.createElement("form",{id:"email-form-2",name:"email-form-2","data-name":"Email Form 2",className:"form-2"},s.a.createElement("div",{className:"div-block"},s.a.createElement("div",null,"Replying to: ",this.props.replyingTo.username),s.a.createElement("div",{className:"login-cancel",onClick:this.props.hideReply},"X")),s.a.createElement("textarea",{onChange:this.inputChangeHandler,id:"field",name:"field",placeholder:"Example Text",maxLength:5e3,className:"textarea w-input",defaultValue:""}),s.a.createElement(w,{outputs:[{amount:0,currency:"BSV",type:"SCRIPT",script:"OP_RETURN "+N("13beK8bifnhuC8pawWvMrPCaWoTQi5LnZf")+" "+N("comment")+" "+N(this.props.replyingTo.path)+" "+N(encodeURIComponent(this.state.reply))+" "+N(this.props.username)+" "+N(this.props.userId)},{to:this.props.replyingTo.address,amount:"0.01",currency:"USD"}],onPayment:this.props.hideReply}))))}}]),t}(s.a.Component),C=a(10).default;function S(e){for(var t="",a=0;a<e.length;a++)t+=""+e.charCodeAt(a).toString(16);return t}var k=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(m.a)(this,Object(c.a)(t).call(this,e))).urlChangeHandler=function(e){a.setState({url:e.target.value})},a.titleChangeHandler=function(e){a.setState({title:e.target.value})},a.state={url:"",title:"",opReturn:""},a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=S("13beK8bifnhuC8pawWvMrPCaWoTQi5LnZf")+" "+S("post/vote")+" "+S("post")+" "+S(encodeURIComponent(this.state.title))+" "+S(encodeURI(this.state.url))+" "+S(this.props.username)+" "+S(this.props.userId);return s.a.createElement("div",{className:"new-post w-form"},s.a.createElement("form",{id:"email-form",name:"email-form","data-name":"Email Form",className:"form"},s.a.createElement("input",{onChange:this.titleChangeHandler,type:"text",className:"text-field w-input",maxLength:256,name:"name","data-name":"Name",placeholder:"Post Title",id:"name"}),s.a.createElement("input",{onChange:this.urlChangeHandler,type:"email",className:"text-field w-input",maxLength:256,name:"email","data-name":"Email",placeholder:"Post URL",id:"email",required:!0}),s.a.createElement("div",{className:"text-block-7"},"* Each post donates $0.01 to ",s.a.createElement("a",{href:"https://faucet.allaboard.cash/",target:"_blank",className:"link"},"faucet.allaboard.cash")),s.a.createElement(C,{outputs:[{amount:0,currency:"BSV",type:"SCRIPT",script:"OP_RETURN "+e},{to:"1JM394PQB47chcs49PCe3JETLDaBwzieBP",amount:"0.01",currency:"USD"}],onPayment:this.props.finishSubmitHandler})))}}]),t}(s.a.Component);a(10).default;function I(e,t){for(var a,n=Math.ceil(e.length/t),s=new Array(n),o=0;o<n;o++)a=o*t,s[o]=e.substring(a,a+t);return s}var O=function(e){function t(e){var a;Object(i.a)(this,t),(a=Object(m.a)(this,Object(c.a)(t).call(this,e))).processPostsVotes=function(e){var t={},n=[];e=e.filter(function(e){var a,s=!1;if(e.out[0].s3)if("post"==e.out[0].s3){if(s=e.out[0].s7&&(a=decodeURI(e.out[0].s5),!!new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(a)||decodeURI(e.out[0].s5).includes("medium"))){var o=!1;e.out[2]&&(o="1JM394PQB47chcs49PCe3JETLDaBwzieBP"==e.out[2].e.a),"1JM394PQB47chcs49PCe3JETLDaBwzieBP"==e.out[1].e.a|o&&(t[e.tx.h]={tx:e,reward:0,voters:[]})}}else"vote"==e.out[0].s3&&(s=e.out[0].s5)&&n.push(e);return s});console.log("votes",n),console.log(t);for(var s=0;s<n.length;s++){var o=n[s].out[0].s4;if(t[o]){var r=t[o].tx.in[0].e.a==n[s].out[1].e.a,i=!1;n[s].out[2]&&(i=t[o].tx.in[0].e.a==n[s].out[2].e.a),r=r||i;var l=n[s].out[0].s5,m=t[o].voters,c=l==t[o].tx.out[0].s7;!r||m.includes(l)||c||(t[o].reward+=i?n[s].out[2].e.v:n[s].out[1].e.v,m.push(l))}}var u=Object.values(t);a.setState({posts:u})},a.loadPosts=function(){var e,t=btoa(JSON.stringify({v:3,q:{find:{"out.s1":"13beK8bifnhuC8pawWvMrPCaWoTQi5LnZf","out.s2":"post/vote"},limit:1e3}}));e="today"==a.state.dateRange?"https://chronos.bitdb.network/q/1P6o45vqLdo6X8HRCZk8XuDsniURmXqiXo/"+t:"https://weekly.bitdb.network/q/12KQyEvGbHcJmavgmB1jDeTSJhJTzQ5ePg/"+t;fetch(e,{headers:{key:"1EsRL44h3xNm8G4hT35ns3nNPicAHWAftc"}}).then(function(e){return e.json()}).then(function(e){var t=JSON.stringify(e,null,2),n=(t=JSON.parse(t)).t;console.log(n),a.processPostsVotes(n),a.setState({transactions:n})})},a.createPostVoteSocket=function(){var e=btoa(JSON.stringify({v:3,q:{find:{"out.s1":"13beK8bifnhuC8pawWvMrPCaWoTQi5LnZf","out.s2":"post/vote"}}}));new EventSource("https://chronos.bitdb.network/s/1P6o45vqLdo6X8HRCZk8XuDsniURmXqiXo/"+e).onmessage=function(e){JSON.parse(JSON.stringify(JSON.parse(e.data),null,2)).data.length>0&&a.loadPosts()}},a.hideLoginAlert=function(){a.setState({showLoginAlert:!1})},a.submitHandler=function(){a.state.loggedIn?1==a.state.posting?a.setState({posting:!1}):a.setState({replying:!1,posting:!0,mode:"new",dateRange:"today"},a.loadPosts):a.setState({showLoginAlert:!0})},a.switchMode=function(){a.loadPosts(),"top"==a.state.mode?a.setState({mode:"new"}):a.setState({mode:"top"})},a.loginHandler=function(){a.setState({loggedIn:!0,userId:a.cookies.get("userId"),username:a.cookies.get("username")}),a.hideLoginAlert()},a.replyHandler=function(e,t,n){a.state.loggedIn?a.setState({replying:!0,replyingTo:{path:e,username:t,address:n}}):a.setState({showLoginAlert:!0})},a.hideReplyFormHandler=function(){a.setState({replying:!1,replyingTo:null})},a.toggleCommentsHandler=function(e){a.state.showCommentsFor==e.tx.h?a.setState({showCommentsFor:null}):a.loadComments(e)},a.processComments=function(e,t){e=e.filter(function(e){var t=!1;return e.out[0].s6&&(t=!0),t});for(var n={},s=0,o=t.tx.h,r=t.in[0].e.a,i=0;i<e.length;i++){var l=r==e[i].out[1].e.a||r==e[i].out[2].e.a,m=e[i].out[0].s6==t.out[0].s7;e[i].out[0].s3.length/64>s&&(s=e[i].out[0].s3.length/64),e[i].out[0].s3==t.tx.h&&l&&!m&&(n[e[i].tx.h]={tx:e[i],comments:0})}if(s>1)for(var c=0;c<e.length;c++){if(128==e[c].out[0].s3.length)if(n[(p=I(e[c].out[0].s3,64))[1]]){l=(r=n[p[1]].tx.in[0].e.a)==e[c].out[1].e.a||r==e[c].out[2].e.a,m=n[p[1]].tx.out[0].s6==e[c].out[0].s6;l&&!m&&(n[p[1]][e[c].tx.h]={tx:e[c],comments:0},n[p[1]].comments+=1)}}if(s>2)for(var u=0;u<e.length;u++){if(192==e[u].out[0].s3.length)if(n[(p=I(e[u].out[0].s3,64))[1]]&&n[p[1]][p[2]]){l=(r=n[p[1]][p[2]].tx.in[0].e.a)==e[u].out[1].e.a||r==e[u].out[2].e.a,m=n[p[1]][p[2]].tx.out[0].s6==e[u].out[0].s6;l&&!m&&(n[p[1]][p[2]][e[u].tx.h]={tx:e[u],comments:0},n[p[1]][p[2]].comments+=1)}}if(s>3)for(var d=0;d<e.length;d++){if(256==e[d].out[0].s3.length)if(n[(p=I(e[d].out[0].s3,64))[1]]&&n[p[1]][p[2]]&&n[p[1]][p[2]][p[3]]){l=(r=n[p[1]][p[2]][p[3]].tx.in[0].e.a)==e[d].out[1].e.a||r==e[d].out[2].e.a,m=n[p[1]][p[2]][p[3]].tx.out[0].s6==e[d].out[0].s6;l&&!m&&(n[p[1]][p[2]][p[3]][e[d].tx.h]={tx:e[d],comments:0},n[p[1]][p[2]][p[3]].comments+=1)}}if(s>4)for(var h=0;h<e.length;h++){var p;if(320==e[h].out[0].s3.length)if(n[(p=I(e[h].out[0].s3,64))[1]]&&n[p[1]][p[2]]&&n[p[1]][p[2]][p[3]]&&n[p[1]][p[2]][p[3]][p[4]]){l=(r=n[p[1]][p[2]][p[3]][p[4]].tx.in[0].e.a)==e[h].out[1].e.a||r==e[h].out[2].e.a,m=n[p[1]][p[2]][p[3]][p[4]].tx.out[0].s6==e[h].out[0].s6;l&&!m&&(n[p[1]][p[2]][p[3]][p[4]][e[h].tx.h]={tx:e[h],comments:0},n[p[1]][p[2]][p[3]][p[4]].comments+=1)}}a.setState({comments:Object.values(n),showCommentsFor:o})},a.loadComments=function(e){var t={v:3,q:{find:{"out.s1":"13beK8bifnhuC8pawWvMrPCaWoTQi5LnZf","out.s2":"comment","out.s3":{$regex:".*"+e.tx.h+".*"}}}},n=btoa(JSON.stringify(t));fetch("https://weekly.bitdb.network/q/12KQyEvGbHcJmavgmB1jDeTSJhJTzQ5ePg/"+n,{headers:{key:"1EsRL44h3xNm8G4hT35ns3nNPicAHWAftc"}}).then(function(e){return e.json()}).then(function(t){var n=JSON.stringify(t,null,2),s=(n=JSON.parse(n)).t;a.processComments(s,e),a.setState({commentsTransactions:s})})},a.createCommentsSocket=function(e){var t={v:3,q:{find:{"out.s1":"13beK8bifnhuC8pawWvMrPCaWoTQi5LnZf","out.s2":"comment","out.s3":{$regex:".*"+e.tx.h+".*"}}}},n="https://chronos.bitdb.network/s/1P6o45vqLdo6X8HRCZk8XuDsniURmXqiXo/"+btoa(JSON.stringify(t));a.commentsSocket=new EventSource(n),a.commentsSocket.onmessage=function(t){var n=JSON.parse(JSON.stringify(JSON.parse(t.data),null,2)).data,s=a.state.commentsTransactions.concat(n);a.state.showCommentsFor==e.tx.h&&(a.processComments(s,e),a.setState({commentsTransactions:s}))}},a.toggleDateRange=function(){var e;e="today"==a.state.dateRange?"weekly":"today",a.setState({mode:"top",dateRange:e},function(){a.loadPosts()})},a.cookies=new y.a;var n=a.cookies.get("username"),s=a.cookies.get("userId"),o={showLoginAlert:!1,loggedIn:!1,replying:!1,replyingTo:null,posting:!1,showCommentsFor:null,commentsTransactions:null,comments:null,mode:"top",dateRange:"today",userId:null,username:null,transactions:[],posts:[]};return n&&s&&(o.username=n,o.userId=s,o.loggedIn=!0),a.state=o,a.loadPosts(),a.createPostVoteSocket(),a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e,t,a=this,n=[],o=this.state.posts.slice();if(e="today"==this.state.dateRange?10:15,"top"==this.state.mode)for(o.sort(function(e,t){return e.reward==t.reward?e.tx.timestamp-t.tx.timestamp:t.reward-e.reward});o.length>e;)o.pop();else o.sort(function(e,t){return t.tx.timestamp-e.tx.timestamp});for(var r=0;r<o.length;r++)n.push(s.a.createElement(v,{loggedIn:this.state.loggedIn,postData:o[r],comments:this.state.comments,showCommentsFor:this.state.showCommentsFor,toggleComments:this.toggleCommentsHandler,replyHandler:this.replyHandler,userId:this.state.userId}));return t=this.state.loggedIn?s.a.createElement("div",{className:"header-right"},s.a.createElement("div",{className:"header-button",onClick:function(){return a.setState({showLoginAlert:!0,changingUsername:!0})}},s.a.createElement("div",{className:"header-button-text"},"change username")),s.a.createElement("div",{className:"username"},this.state.username)):s.a.createElement("div",{className:"header-right"},s.a.createElement("div",{className:"header-button",onClick:function(){return a.setState({showLoginAlert:!0})}},s.a.createElement("div",{className:"header-button-text"},"login"))),s.a.createElement("div",null,s.a.createElement("meta",{charSet:"utf-8"}),s.a.createElement("title",null,"bsvnews"),s.a.createElement("meta",{content:"width=device-width, initial-scale=1",name:"viewport"}),s.a.createElement("meta",{content:"Webflow",name:"generator"}),s.a.createElement("div",{className:"container w-container",style:{paddingBottom:10}},s.a.createElement("div",{className:"header"},s.a.createElement("div",{className:"header-left",style:{flexWrap:"wrap"}},s.a.createElement("div",{className:"title"},"BSV News"),s.a.createElement("div",{className:"button-container"},"today"==this.state.dateRange?s.a.createElement("div",{className:"header-button",onClick:this.switchMode}," ",s.a.createElement("div",{className:"header-button-text"},"top"==this.state.mode?"new":"top"," ")," "):null,s.a.createElement("div",{className:"header-button",onClick:this.submitHandler}," ",s.a.createElement("div",{className:"header-button-text"},this.state.posting?" X ":"submit")),s.a.createElement("div",{className:"header-button",onClick:this.loadPosts}," ",s.a.createElement("div",{className:"header-button-text"},"reload")),s.a.createElement("div",{className:"header-button",onClick:this.toggleDateRange}," ",s.a.createElement("div",{className:"header-button-text"},"today"==this.state.dateRange?"weekly":"today")))),t),this.state.showLoginAlert?s.a.createElement(b,{xHandler:this.hideLoginAlert,loginHandler:this.loginHandler}):null,this.state.posting?s.a.createElement(k,{username:this.state.username,userId:this.state.userId,finishSubmitHandler:this.submitHandler}):null,s.a.createElement("div",{className:"posts"},n),this.state.replying?s.a.createElement(x,{hideReply:this.hideReplyFormHandler,replyingTo:this.state.replyingTo,username:this.state.username,userId:this.state.userId}):null,s.a.createElement("div",{className:"metadata",style:{width:"100%",padding:10,paddingBottom:0,paddingRight:20,display:"flex",justifyContent:"flex-end"}}," flexwrap test Created by $canyouhandleme")))}}]),t}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(s.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[17,1,2]]]);
//# sourceMappingURL=main.0502afdc.chunk.js.map